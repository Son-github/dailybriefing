server:
  # Terraform(ECS)에서 SERVER_PORT 전달 → 없으면 8082
  port: ${SERVER_PORT:8082}
  forward-headers-strategy: native

spring:
  datasource:
    # 우선순위: SPRING_DATASOURCE_* → POSTGRES_* → DB_* → 기본값
    url: ${SPRING_DATASOURCE_URL}
    # ✅ RDS 관리형 시크릿에서 ECS가 주입
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      initialization-fail-timeout: ${SPRING_DATASOURCE_HIKARI_INITIALIZATION_FAIL_TIMEOUT:0}

  jpa:
    hibernate:
      ddl-auto: update    # 운영 안전 기본 (create는 매 배포시 드랍 위험)
    show-sql: true
    properties:
      hibernate:
        format_sql: true
    database-platform: org.hibernate.dialect.PostgreSQLDialect

  # CloudFront → ALB CORS 대응 (필요 시 FRONTEND_ORIGIN으로 제한)
  mvc:
    cors:
      mappings:
        "[/**]":
          # CloudFront 도메인을 지정하고 싶으면 FRONTEND_ORIGIN에 설정(쉼표 구분 다중 가능)
          allowed-origins: ${CORS_ALLOWED_ORIGINS:${FRONTEND_ORIGIN:*}}
          allowed-methods: "GET,POST,OPTIONS"
          allowed-headers: "*"
          allow-credentials: true

# ALB Target Group 헬스체크: /actuator/health 로 200 응답
management:
  endpoints:
    web:
      exposure:
        include: "health,info"
  endpoint:
    health:
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true

external:
  exchange:
    api-url: ${EXCHANGE_API_URL:https://oapi.koreaexim.go.kr/site/program/financial/exchangeJSON}
    service-key: ${EXCHANGE_API_KEY}
    data: ${EXCHANGE_DATA_CODE:AP01}
    timeout-ms: ${EXCHANGE_API_TIMEOUT_MS:5000}

logging:
  level:
    org.hibernate.SQL: debug
    org.hibernate.type.descriptor.sql: trace
    org.springframework.security: info

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html


